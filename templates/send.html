{% extends "layout.html" %}
{% set active_page = "send" %}
{% block body %}
<h2> Send a Text </h2>

<form action="{{ url_for('send_text') }}" method=post class="form" role="form">
  <div class="form-group">
    <label for="InputNumber">Enter number for text:</label>
    <input class="form-control" type=text id="InputNumber" name="number">
  </div>
  <div class="form-group">
    <label for="InputMessage">Enter message for text:</label>
    <input class="form-control" type=text id="InputMessage" name="message">
  </div>
  <button type=submit id="SendTextbtn" value=Send class="btn btn-default disabled">Submit</button>
  <button type="button" id="Phonebook_Button" class="btn btn-default" data-toggle="modal" data-target=".bs-example-modal-sm">PhoneBook</button>
  </form>

{% if error %} <div class="error"><strong>Error:</strong> {{ error }}{% endif %} 

<!-- Large modal -->

<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="phonebookModal">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;
        </span><span class="sr-only">Close</span></button>  
        <h4 class="modal-title">Contacts</h4> 
      </div>
      <div class="modal-body">
        <form id="contactForm" method="post" role='form'>
          <div class="radio">
            {% for user in users %}
            <label>  <input type="radio" id="Contact" name="person" value="{{user}}"/> {{user}} </label>
            <br>
          {% endfor %}
        </div>
      
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Select</button>
        
        
      </div>
      </form> 
    </div>
  </div>
</div>
<script>
    var US_CA_PHONE_NO_REGEX = /^1[\s.-]?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/;
    
    function updateSubmitStatus(){
            if($("#InputNumber").parent().hasClass("has-success") && $("#InputMessage").parent().hasClass("has-success")){
                $("#SendTextbtn").removeClass("disabled")
            } else{
                $("#SendTextbtn").addClass("disabled")
            }
        }
    
    $(document).ready(function(){

        $('#phonebookModal').on('hidden.bs.modal', function () {
          var str = ($("#contactForm input[type='radio']:checked").val());
          var str_parsed = str.split(" - ")
          $('#InputNumber').val(str_parsed[1])
        })

        $("#InputNumber").on("change keyup paste click", function(){
            var current_number = $(this).val()
            
            if(current_number != "" && current_number.match(US_CA_PHONE_NO_REGEX)){
               $(this).parent().removeClass("has-error")
               $(this).parent().addClass("has-success")
            }else {
               $(this).parent().removeClass("has-success")
               $(this).parent().addClass("has-error")
            }
            
            
            updateSubmitStatus();
        })

        $("#InputMessage").on("change keyup paste click", function(){
            var current_message = $(this).val()
            if(current_message.length > 0){
                $(this).parent().removeClass("has-error")
                $(this).parent().addClass("has-success")
            } else {
                $(this).parent().removeClass("has-success")
                $(this).parent().addClass("has-error")
            }
            updateSubmitStatus();
        })
        
        $("form").bind("keyup keypress", function(e) {
              var code = e.keyCode || e.which; 
              if (code  == 13) {               
                e.preventDefault();
                return false;
              }
            });
       
       })


</script>
{% endblock %}
